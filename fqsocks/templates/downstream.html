<!DOCTYPE html>
<html>
<head>
    <title>fqrouter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link href="/assets/bootstrap/css/bootstrap.css" rel="stylesheet" media="screen">
    <link href="/assets/bootstrap/css/bootstrap-theme.css" rel="stylesheet" media="screen">
    <style type="text/css">
        th.sort-header {
            cursor:pointer;
        }
        th.sort-header::-moz-selection,
        th.sort-header::selection {
            background:transparent;
        }
        table th.sort-header:after {
            content:'';
            float:right;
            margin-top:7px;
            border-width:0 4px 4px;
            border-style:solid;
            border-color:#404040 transparent;
            visibility:hidden;
        }
        table th.sort-header:hover:after {
            visibility:visible;
        }
        table th.sort-up:after,
        table th.sort-down:after,
        table th.sort-down:hover:after {
            visibility:visible;
            opacity:0.4;
        }
        table th.sort-up:after {
            border-bottom:none;
            border-width:4px 4px 0;
        }
        table.portrait .tx-speed {
            display: none;
        }
        table.portrait .rx-speed {
            display: none;
        }
        body {
            margin-top: 16px;
        }
        #ajax-loader {
            background:url('/assets/ajax-loader.gif') center center no-repeat white;
            position:absolute;
            height: 100%;
            width: 100%;
            top: 0;
            left: 0;
            border-radius:10px;
            zoom: 1;
            filter: alpha(opacity=50);
            opacity: 0.5;
        }
    </style>
</head>
<body>
<div class="col-sm-12">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title pull-left">我的小伙伴们</h3>
            <button class="btn btn-default pull-right">Expand</button>
            <div style="clear: both;"></div>
        </div>
        <div class="panel-body hide">
            asdafsdf
        </div>
    </div>
</div>
<div class="col-sm-12">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title pull-left">Pick & Play</h3>
            <button class="btn btn-primary pull-right" id="scan">{{ _('Scan', '扫描') }}</button>
            <div style="clear: both;"></div>
        </div>
        <div class="panel-body">
            {{ _(
            """
            scan the currently connected wifi network to discover your other devices (iphone, windows pc, etc). pick any device from the list, then that device will route via fqrouter to access restricted website such as youtube or twitter.
            """,
            """
            扫描当前网络中的其他设备（iPhone，个人电脑等）。然后从扫描出来的列表中选取你希望翻墙的设备，这样那台设备就可以通过fqrouter翻墙了。
            """) }}
        </div>
    </div>
</div>
<div class="col-sm-12 hide" id="lan-devices">
    <div class="panel panel-default">
        <div class="panel-body" style="position: relative;">
            <div id="ajax-loader" class="hide"></div>
            <table class="table table-striped" style="margin-bottom: 0;">
                <thead>
                <tr>
                    <th>{{ _('ip', 'ip') }}</th>
                    <th>{{ _('hostname', '机器名') }}</th>
                    <th class="no-sort">{{ _('picked', '已选中') }}</th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="/assets/jquery.min.js"></script>
<script src="/assets/bootstrap/js/bootstrap.min.js"></script>
<script src="/assets/tablesort.min.js"></script>
<script src="/assets/visibility.core.js"></script>
<script src="/assets/visibility.timer.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        var tablesort = new Tablesort($('#lan-devices table')[0]);

        var timerId;

        function refreshLanDevices() {
            $('#lan-devices').removeClass('hide');
            $.get('/lan/devices', function(html) {
                $('#lan-devices tbody').replaceWith(html);
                tablesort.refresh();
                if ($('#lan-devices tbody').data('isScanCompleted')) {
                    $('#ajax-loader').addClass('hide');
                    Visibility.stop(timerId);
                    timerId = null;
                }
            });
        }

        $('#lan-devices').on('click', 'tr input[type=checkbox]', function() {
            var ip = $(this).parents('tr').data('ip');
            $.post('/lan/update', {ip:ip,is_picked:$(this).is(':checked')}, function(){
                refreshLanDevices();
            });
        });

        $('#scan').click(function() {
            $('#ajax-loader').removeClass('hide');
            $.post('/lan/scan');
            refreshLanDevices();
            if (!timerId) {
                timerId = Visibility.every(1000, refreshLanDevices);
            }
        });
    });
</script>
</body>
</html>