<!DOCTYPE html>
<html>
<head>
    <title>fqrouter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link href="/assets/bootstrap/css/bootstrap.css" rel="stylesheet" media="screen">
    <link href="/assets/bootstrap/css/bootstrap-theme.css" rel="stylesheet" media="screen">
    <style type="text/css">
        th.sort-header {
            cursor: pointer;
        }

        th.sort-header::-moz-selection,
        th.sort-header::selection {
            background: transparent;
        }

        table th.sort-header:after {
            content: '';
            float: right;
            margin-top: 7px;
            border-width: 0 4px 4px;
            border-style: solid;
            border-color: #404040 transparent;
            visibility: hidden;
        }

        table th.sort-header:hover:after {
            visibility: visible;
        }

        table th.sort-up:after,
        table th.sort-down:after,
        table th.sort-down:hover:after {
            visibility: visible;
            opacity: 0.4;
        }

        table th.sort-up:after {
            border-bottom: none;
            border-width: 4px 4px 0;
        }

        table.portrait .tx-speed {
            display: none;
        }

        table.portrait .rx-speed {
            display: none;
        }

        body {
            margin-top: 16px;
        }

        #ajax-loader {
            background: url('/assets/ajax-loader.gif') center center no-repeat white;
            position: absolute;
            height: 100%;
            width: 100%;
            top: 0;
            left: 0;
            border-radius: 10px;
            zoom: 1;
            filter: alpha(opacity=50);
            opacity: 0.5;
        }

        .onoffswitch {
            position: relative;
            width: 90px;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .onoffswitch-checkbox {
            display: none;
        }

        .onoffswitch-label {
            display: block;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid #666666;
            border-radius: 30px;
        }

        .onoffswitch-inner {
            width: 200%;
            margin-left: -100%;
            -moz-transition: margin 0.3s ease-in 0s;
            -webkit-transition: margin 0.3s ease-in 0s;
            -o-transition: margin 0.3s ease-in 0s;
            transition: margin 0.3s ease-in 0s;
        }

        .onoffswitch-inner:before, .onoffswitch-inner:after {
            float: left;
            width: 50%;
            height: 30px;
            padding: 0;
            line-height: 30px;
            font-size: 16px;
            color: white;
            font-family: Trebuchet, Arial, sans-serif;
            font-weight: bold;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            border-radius: 30px;
            box-shadow: 0px 15px 0px rgba(0, 0, 0, 0.08) inset;
        }

        .onoffswitch-inner:before {
            content: "ON";
            padding-left: 15px;
            background-color: #6BB2ED;
            color: #FFFFFF;
            border-radius: 30px 0 0 30px;
        }

        .onoffswitch-inner:after {
            content: "OFF";
            padding-right: 15px;
            background-color: #FFFFFF;
            color: #666666;
            text-align: right;
            border-radius: 0 30px 30px 0;
        }

        .onoffswitch-switch {
            width: 30px;
            margin: 0px;
            background: #FFFFFF;
            border: 2px solid #666666;
            border-radius: 30px;
            position: absolute;
            top: 0;
            bottom: 0;
            right: 56px;
            -moz-transition: all 0.3s ease-in 0s;
            -webkit-transition: all 0.3s ease-in 0s;
            -o-transition: all 0.3s ease-in 0s;
            transition: all 0.3s ease-in 0s;
            background-image: -moz-linear-gradient(center top, rgba(0, 0, 0, 0.1) 0%, rgba(0, 0, 0, 0) 80%);
            background-image: -webkit-linear-gradient(center top, rgba(0, 0, 0, 0.1) 0%, rgba(0, 0, 0, 0) 80%);
            background-image: -o-linear-gradient(center top, rgba(0, 0, 0, 0.1) 0%, rgba(0, 0, 0, 0) 80%);
            background-image: linear-gradient(center top, rgba(0, 0, 0, 0.1) 0%, rgba(0, 0, 0, 0) 80%);
            box-shadow: 0 1px 1px white inset;
        }

        .onoffswitch-checkbox:checked + .onoffswitch-label .onoffswitch-inner {
            margin-left: 0;
        }

        .onoffswitch-checkbox:checked + .onoffswitch-label .onoffswitch-switch {
            right: 0px;
        }
    </style>
</head>
<body>
<div class="col-sm-12">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title pull-left">我的小伙伴们</h3>
            <button class="btn btn-default pull-right">Expand</button>
            <div style="clear: both;"></div>
        </div>
        <div class="panel-body hide">
            asdafsdf
        </div>
    </div>
</div>
<div class="col-sm-12">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title pull-left">Pick & Play</h3>
            <button class="btn btn-primary pull-right" id="scan">{{ _('Scan', '扫描') }}</button>
            <div style="clear: both;"></div>
        </div>
        <div class="panel-body">
            {{ _(
            """
            Scan the currently connected wifi network to discover your other devices (iphone, windows pc, etc).
            Pick any device from the list, then that device will route via fqrouter to access restricted website such as
            youtube or twitter.
            """,
            """
            扫描当前网络中的其他设备（iPhone，个人电脑等）。然后从扫描出来的列表中选取你希望翻墙的设备，这样那台设备就可以通过fqrouter翻墙了。
            """) }}
        </div>
    </div>
</div>
<div class="col-sm-12 hide" id="lan-devices">
    <div class="panel panel-default">
        <div class="panel-body" style="position: relative;">
            <div id="ajax-loader" class="hide"></div>
            <table class="table table-striped" style="margin-bottom: 0;">
                <thead>
                <tr>
                    <th>{{ _('ip', 'ip') }}</th>
                    <th>{{ _('hostname', '机器名') }}</th>
                    <th class="no-sort">{{ _('picked', '已选中') }}</th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
</div>
<div class="col-sm-4">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title pull-left">{{ _('Remote Access', '远程访问') }}</h3>
            <a data-toggle="modal" href="#myModal" class="btn btn-default pull-right" id="config-http-manager">{{ _('Config', '配置') }}</a>
            <div style="clear: both;"></div>
        </div>
        <div class="panel-body">
            {{ _(
            """
            Pick & Play can be controlled from the other end.
            Give following url to your friends, so they can control if they want to tunnel via your mobile or not.
            """,
            """
            Pick & Play 也可以从另外一端来控制。把下面的URL给你的朋友们，这样TA们就可以自己控制是否要通过你的手机代理上网了。
            """) }}
            <h3>http://{{ default_interface_ip }}:{{ httpd.LISTEN_PORT }}/downstream</h3>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Modal title</h4>
            </div>
            <div class="modal-body">
                ...
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<div class="col-sm-4">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title pull-left">{{ _('HTTP Proxy', 'HTTP代理') }}</h3>
            <div class="onoffswitch pull-right">
                <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="http-gateway-checkbox"
                {{ 'checked="checked"' if http_gateway.server_greenlet else '' }}>
                <label class="onoffswitch-label" for="http-gateway-checkbox">
                    <div class="onoffswitch-inner"></div>
                    <div class="onoffswitch-switch"></div>
                </label>
            </div>
            <div style="clear: both;"></div>
        </div>
        <div class="panel-body">
            {{ _(
            """
            Share uncensored internet to friends nearby. They just need to set http proxy in their device
            to the following values. If you do not know what is this about, just google for it :
            """,
            """
            把翻墙网络共享给周围的朋友。TA们只需要把设备上的HTTP代理设置为下面的值就可以了。搞不明白的朋友请自行Google：
            """) }}
            <ul class="list-group" style="margin-bottom: 0;">
                <li class="list-group-item">HTTP: {{ default_interface_ip }}:{{ http_gateway.LISTEN_PORT }}</li>
                <li class="list-group-item">PAC: http://{{ default_interface_ip }}:{{ httpd.LISTEN_PORT }}/pac</li>
            </ul>
        </div>
    </div>
</div>
<script src="/assets/jquery.min.js"></script>
<script src="/assets/bootstrap/js/bootstrap.min.js"></script>
<script src="/assets/tablesort.min.js"></script>
<script src="/assets/visibility.core.js"></script>
<script src="/assets/visibility.timer.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        var tablesort = new Tablesort($('#lan-devices table')[0]);

        var timerId;

        function refreshLanDevices() {
            $('#lan-devices').removeClass('hide');
            $.get('/lan/devices', function (html) {
                $('#lan-devices tbody').replaceWith(html);
                tablesort.refresh();
                if ($('#lan-devices tbody').data('isScanCompleted')) {
                    $('#ajax-loader').addClass('hide');
                    Visibility.stop(timerId);
                    timerId = null;
                }
            });
        }

        $('#lan-devices').on('click', 'tr input[type=checkbox]', function () {
            var ip = $(this).parents('tr').data('ip');
            $.post('/lan/update', {ip: ip, is_picked: $(this).is(':checked')}, function () {
                refreshLanDevices();
            });
        });

        $('#scan').click(function () {
            $('#ajax-loader').removeClass('hide');
            $.post('/lan/scan');
            refreshLanDevices();
            if (!timerId) {
                timerId = Visibility.every(1000, refreshLanDevices);
            }
        });

        $('#http-gateway-checkbox').click(function () {
            if ($(this).is(':checked')) {
                $.post('/http-gateway/enable');
            } else {
                $.post('/http-gateway/disable');
            }
        });
    });
</script>
</body>
</html>